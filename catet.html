<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catet!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #F8FAFB; }
        
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-item { opacity: 0; animation: fadeUp 0.5s ease forwards; }
    </style>
</head>
<body class="pb-40"> 
    
    <header class="p-8 bg-[#005461] text-white rounded-b-[3.5rem] shadow-xl relative z-20">
        <button onclick="location.href='index.html'" class="mb-4 opacity-70 text-sm italic flex items-center"><i class="fas fa-arrow-left mr-2"></i> Kembali</button>
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-black tracking-tighter uppercase">CATET<span class="text-[#00B7B5]">!</span></h1>
                <p class="text-[9px] font-bold text-[#00B7B5] uppercase tracking-[0.2em]">Catatan Pengeluaran</p>
            </div>
            <i class="fas fa-wallet text-2xl text-[#00B7B5]"></i>
        </div>
    </header>

    <main class="p-6 -mt-8 relative z-30">
        <div class="bg-white p-7 rounded-[2.5rem] shadow-xl border border-slate-100 mb-8 text-center">
            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1">Total Pengeluaran</p>
            <h2 id="total-pengeluaran" class="text-3xl font-black text-[#005461] tracking-tighter">Rp 0</h2>
        </div>

        <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100 mb-8 space-y-4">
            <div>
                <label class="text-[9px] font-black text-[#00B7B5] uppercase ml-2 mb-1 block">Tanggal</label>
                <input type="date" id="catet-tgl" class="w-full px-5 py-4 bg-[#F4F4F4] rounded-2xl text-sm font-bold border-none focus:ring-2 focus:ring-[#00B7B5]">
            </div>
            
            <div>
                <label class="text-[9px] font-black text-[#00B7B5] uppercase ml-2 mb-1 block">Keterangan</label>
                <input type="text" id="catet-item" placeholder="Kuota internet" class="w-full px-5 py-4 bg-[#F4F4F4] rounded-2xl text-sm font-bold border-none">
            </div>

            <div>
                <label class="text-[9px] font-black text-[#00B7B5] uppercase ml-2 mb-1 block">Nominal (Rp)</label>
                <input type="number" id="catet-nominal" placeholder="50000" class="w-full px-5 py-4 bg-[#F4F4F4] rounded-2xl text-sm font-bold border-none">
            </div>
            
            <button onclick="simpanCatatan()" class="w-full bg-[#005461] text-white font-black py-4 rounded-2xl shadow-lg uppercase text-xs active:scale-95 transition-all mt-2">
                Simpan Catatan
            </button>
        </div>

        <div class="flex justify-between items-center px-4 mb-4">
            <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Riwayat</h3>
            <span id="count-item" class="text-[10px] font-bold text-[#00B7B5]">0 Transaksi</span>
        </div>
        <div id="list-catetan" class="space-y-3"></div>
    </main>

    <div class="fixed bottom-6 left-0 right-0 px-8 z-50">
        <nav class="bg-[#005461]/95 backdrop-blur-xl p-3 rounded-full flex justify-between items-center shadow-2xl border border-white/10">
            <button onclick="location.href='index.html'" class="w-12 h-12 flex items-center justify-center text-[#00B7B5] bg-white rounded-full shadow-lg">
                <i class="fas fa-home text-lg"></i>
            </button>
            <!--
            <button onclick="location.href='profile.html'" class="w-12 h-12 flex items-center justify-center text-white bg-white/10 rounded-full">
                <i class="fas fa-user text-lg"></i>
            </button>
            -->

            <div id="auth-section">
                </div>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7rGI9iL0M889t6PR8za1-PxvjA_6jdHQ",
            authDomain: "websekawan.firebaseapp.com",
            projectId: "websekawan",
            databaseURL: "https://websekawan-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:407413490869:web:093f8a187261c68ea36afc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const userHp = localStorage.getItem('userHp');

        // Logic Navbar Logout
        const authSection = document.getElementById('auth-section');
        if(userHp) {
            authSection.innerHTML = `
                <button onclick="handleLogout()" class="w-12 h-12 flex items-center justify-center text-red-400 bg-white rounded-full shadow-lg">
                    <i class="fas fa-power-off text-lg"></i>
                </button>`;
        } else {
            authSection.innerHTML = `
                <button onclick="location.href='login.html'" class="w-12 h-12 flex items-center justify-center text-[#00B7B5] bg-white rounded-full shadow-lg">
                    <i class="fas fa-right-to-bracket text-lg"></i>
                </button>`;
            alert("Harap login terlebih dahulu!");
            location.href = 'login.html';
        }

        const formatTglIndo = (tgl) => {
            return new Date(tgl).toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });
        };

        window.simpanCatatan = () => {
            const item = document.getElementById('catet-item').value;
            const nominal = document.getElementById('catet-nominal').value;
            const tgl = document.getElementById('catet-tgl').value;

            if(item && nominal && tgl) {
                push(ref(db, `catet/${userHp}`), {
                    item, nominal: parseInt(nominal), tgl, createdAt: Date.now()
                }).then(() => {
                    document.getElementById('catet-item').value = "";
                    document.getElementById('catet-nominal').value = "";
                });
            } else {
                alert("Lengkapi data dulu, bro!");
            }
        };

        window.loadCatatan = () => {
            onValue(ref(db, `catet/${userHp}`), (snap) => {
                const list = document.getElementById('list-catetan');
                let html = ""; let total = 0; let count = 0;
                
                if(snap.exists()) {
                    let items = [];
                    snap.forEach(c => { items.push({...c.val(), key: c.key}); });
                    items.sort((a,b) => new Date(b.tgl) - new Date(a.tgl));

                    items.forEach((d, index) => {
                        total += d.nominal; count++;
                        html += `
                        <div class="bg-white p-5 rounded-[2rem] border border-slate-100 shadow-sm flex justify-between items-center animate-item" style="animation-delay: ${index * 0.05}s">
                            <div>
                                <h4 class="text-[11px] font-black text-[#005461] uppercase">${d.item}</h4>
                                <p class="text-[9px] font-bold text-slate-400 mt-0.5">${formatTglIndo(d.tgl)}</p>
                                <p class="text-sm font-black text-[#00B7B5] mt-1">Rp ${d.nominal.toLocaleString('id-ID')}</p>
                            </div>
                            <button onclick="hapusCatet('${d.key}')" class="w-10 h-10 flex items-center justify-center text-red-200 hover:text-red-500 transition-colors">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>`;
                    });
                }
                list.innerHTML = html || '<p class="text-center py-10 opacity-30 italic text-xs">Belum ada catatan...</p>';
                document.getElementById('total-pengeluaran').innerText = 'Rp ' + total.toLocaleString('id-ID');
                document.getElementById('count-item').innerText = count + ' Transaksi';
            });
        };

        window.hapusCatet = (k) => { if(confirm("Hapus catatan ini?")) remove(ref(db, `catet/${userHp}/${k}`)); };
        window.handleLogout = () => { if(confirm("Yakin mau keluar?")) { localStorage.clear(); location.href='index.html'; } };

        window.onload = () => {
            document.getElementById('catet-tgl').valueAsDate = new Date();
            loadCatatan();
        };
    </script>
</body>
                </html>
            
