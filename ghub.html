<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sekawan AdminHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-slate-50 p-6">
    <div class="max-w-md mx-auto space-y-6">
        <div class="bg-[#005461] p-8 rounded-[2.5rem] shadow-xl text-white">
            <h1 class="font-black text-2xl italic">Admin<span class="text-[#00B7B5]">Hub</span></h1>
            <p class="text-[10px] opacity-70 mt-1 uppercase font-bold tracking-widest">Whitelist Management</p>
        </div>

        <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
            <label class="text-[10px] font-black uppercase text-slate-400 ml-2">Input Email Google Warga</label>
            <div class="flex gap-2 mt-2">
                <input type="email" id="email-warga" placeholder="warga@gmail.com" 
                    class="flex-1 p-4 bg-slate-50 rounded-2xl text-sm font-bold border-none outline-none focus:ring-2 focus:ring-[#00B7B5]">
                <button onclick="addWarga()" class="bg-[#005461] text-white w-14 h-14 rounded-2xl flex items-center justify-center active:scale-90 transition-all shadow-lg">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <div class="space-y-3" id="container-warga">
            <p class="text-center text-xs text-slate-400 animate-pulse">Menghubungkan ke Database...</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7rGI9iL0M889t6PR8za1-PxvjA_6jdHQ",
            authDomain: "websekawan.firebaseapp.com",
            projectId: "websekawan",
            databaseURL: "https://websekawan-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:407413490869:web:093f8a187261c68ea36afc"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- FUNGSI TAMBAH WARGA ---
        window.addWarga = () => {
            const emailInput = document.getElementById('email-warga').value;
            // Bersihkan email: huruf kecil semua dan hapus spasi
            const cleanEmail = emailInput.toLowerCase().trim();

            if (cleanEmail.includes('@gmail.com')) {
                const userRef = ref(db, 'users');
                // Push data sebagai object {email: "..."}
                push(userRef, {
                    email: cleanEmail,
                    role: "warga",
                    addedAt: new Date().toISOString()
                }).then(() => {
                    document.getElementById('email-warga').value = "";
                    alert("Email " + cleanEmail + " Berhasil Didaftarkan!");
                }).catch((error) => {
                    alert("Gagal: " + error.message);
                });
            } else {
                alert("Gunakan email @gmail.com yang valid!");
            }
        };

        // --- TAMPILKAN DAFTAR WARGA ---
        onValue(ref(db, 'users'), (snapshot) => {
            const container = document.getElementById('container-warga');
            container.innerHTML = "";
            
            if (snapshot.exists()) {
                snapshot.forEach((child) => {
                    const data = child.val();
                    const key = child.key;
                    container.innerHTML += `
                        <div class="bg-white p-5 rounded-3xl flex justify-between items-center shadow-sm border border-slate-50">
                            <div>
                                <p class="text-xs font-black text-[#005461]">${data.email}</p>
                                <p class="text-[8px] text-slate-400 font-bold uppercase tracking-tighter">Verified Warga</p>
                            </div>
                            <button onclick="hapusWarga('${key}')" class="text-red-400 bg-red-50 w-10 h-10 rounded-xl flex items-center justify-center active:bg-red-100 transition-colors">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </button>
                        </div>
                    `;
                });
            } else {
                container.innerHTML = `<div class="text-center p-10 bg-white rounded-3xl border-2 border-dashed border-slate-200">
                    <p class="text-[10px] font-black text-slate-300 uppercase">Belum ada warga terdaftar</p>
                </div>`;
            }
        });

        // --- FUNGSI HAPUS ---
        window.hapusWarga = (id) => {
            if (confirm("Hapus warga dari whitelist?")) {
                remove(ref(db, 'users/' + id));
            }
        };
    </script>
</body>
</html>
