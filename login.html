<div id="login-container">
    <div id="login-step-1" class="space-y-4 text-left">
        <div>
            <label class="text-[10px] font-black text-[#018790] uppercase ml-4 mb-2 block">Nama Warga</label>
            <input type="text" id="username" placeholder="Nama sesuai KTP" class="w-full px-6 py-4 bg-[#F4F4F4] rounded-full border-none focus:ring-2 focus:ring-[#00B7B5] outline-none text-sm font-bold uppercase">
        </div>
        <div>
            <label class="text-[10px] font-black text-[#018790] uppercase ml-4 mb-2 block">Nomor HP (WhatsApp)</label>
            <input type="number" id="password" placeholder="0812xxxx" class="w-full px-6 py-4 bg-[#F4F4F4] rounded-full border-none focus:ring-2 focus:ring-[#00B7B5] outline-none text-sm font-bold">
        </div>
        <button id="btn-request-otp" class="w-full bg-[#005461] text-white font-black py-4 rounded-full shadow-xl">KIRIM OTP KE HP SAYA</button>
    </div>

    <div id="login-step-2" class="hidden space-y-4 text-left mt-4">
        <div class="bg-amber-50 p-4 rounded-2xl border border-amber-100 text-center text-[#005461]">
            <p class="text-[10px] font-bold uppercase">Cek WhatsApp Anda, Kode telah dikirim!</p>
        </div>
        <input type="number" id="otp-input" placeholder="6 DIGIT OTP" class="w-full px-6 py-4 bg-[#F4F4F4] rounded-full border-none focus:ring-2 focus:ring-[#00B7B5] outline-none text-center text-lg font-black tracking-[0.5em]">
        <button id="btn-verify-otp" class="w-full bg-[#00B7B5] text-white font-black py-4 rounded-full shadow-xl">VERIFIKASI & MASUK</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { /* ... config lo ... */ };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const API_URL = "https://script.google.com/macros/s/AKfycbx9JsUb0saYvFnH8vpCn2JZu_AzdrXXXmQIcGfMW0dsTvPndFQC_CtKyLhMx_6Kjd_IEg/exec";
    let generatedOTP = "";
    let savedPhone = "";

    // 1. KIRIM OTP
    document.getElementById('btn-request-otp').onclick = async () => {
        const nameIn = document.getElementById('username').value.toLowerCase().trim();
        const phoneIn = document.getElementById('password').value.trim();
        const btn = document.getElementById('btn-request-otp');

        btn.innerText = "MENGECEK DATA...";
        
        const snap = await get(ref(db, `users/${nameIn}`));
        
        if (snap.exists() && snap.val().nohp === phoneIn) {
            generatedOTP = Math.floor(100000 + Math.random() * 900000).toString();
            savedPhone = phoneIn;

            // KIRIM KE API GOOGLE APPS SCRIPT LO
            btn.innerText = "MENGIRIM OTP...";
            
            fetch(API_URL, {
                method: "POST",
                mode: "no-cors", // Penting untuk Apps Script
                body: JSON.stringify({
                    action: "sendOTP",
                    number: savedPhone,
                    message: `[SEKWAN DIGITAL] Kode OTP Anda adalah: ${generatedOTP}. JANGAN BERIKAN KODE INI KEPADA SIAPAPUN.`
                })
            }).then(() => {
                document.getElementById('login-step-1').classList.add('hidden');
                document.getElementById('login-step-2').classList.remove('hidden');
            }).catch(err => {
                alert("Gagal mengirim pesan. Cek koneksi.");
                btn.innerText = "KIRIM OTP KE HP SAYA";
            });

        } else {
            alert("Nama atau No HP tidak terdaftar di sistem RT!");
            btn.innerText = "KIRIM OTP KE HP SAYA";
        }
    };

    // 2. VERIFIKASI
    document.getElementById('btn-verify-otp').onclick = () => {
        const otpIn = document.getElementById('otp-input').value;
        if (otpIn === generatedOTP) {
            localStorage.setItem('isLoggedIn', 'true');
            location.href = 'index.html';
        } else {
            alert("Kode OTP Salah!");
        }
    };
            </script>
            
